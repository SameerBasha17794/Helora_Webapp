<div ng-include="'layout/header.view.html'"></div>
<script src="js/responsive-calendar.js" type="text/javascript"></script>
<div class="mdcl-mn">
<a class="back-btn" ng-click="goback()" style="cursor: pointer;">
<div> <i aria-hidden="true" class="fa fa-arrow-circle-left"></i> </div>
</a>
<div class="container">
<div class="mdcl-cont">
  <div class="mdcl-hd">
    <div class="mdcl-img"> <img src="images/{{image}}.png" alt="Doctor-Image"></div>
    <ol>
      <li class="ol-actv"></li>
      <li class="ol-actv"></li>
      <li></li>
    </ol>
  </div>
  <h1> Please choose an appointment window:</h1>
  <p> Your appointment starts when the specialist calls you.</p>
  <div class="row">
    <div class="col-md-8 col-md-offset-2 col-xs-10 col-xs-offset-1 mT30">
      <div class="row">
        <div class="col-md-12">
          <ul class="list-inline tab mB40">
            <li class="active">Calander</li>
            <!--<li><a href="choose-appointment-listing">Listing</a></li>-->
          </ul>
        </div>
      </div>
      <div class="responsive-calendar">
        <div class="controls"> <a class="pull-left" data-go="prev">
          <div class="btn btn-them1"> < Prev </div>
          </a>
          <h4> <span data-head-month></span><span data-head-year></span> </h4>
          <a class="pull-right" data-go="next">
          <div class="btn btn-them1"> Next ></div>
          </a> </div>
        <hr />
        <div class="day-headers">
          <div class="day header"> Mon</div>
          <div class="day header"> Tue</div>
          <div class="day header"> Wed</div>
          <div class="day header"> Thu</div>
          <div class="day header"> Fri</div>
          <div class="day header"> Sat</div>
          <div class="day header"> Sun</div>
        </div>
        <div class="days" data-group="days"> </div>
      </div>
      <input type="text" ng-model="doctorType" name="doctorType" id="doctorType" style="height: 0px;width: 0px"/>
      <input type="text" ng-model="bookDocId" name="bookDocId" id="bookDocId" style="height: 0px;width: 0px"/>
      <div class="row">
        <div class="panel panel-info col-md-12">
          <div id="selected_free_timeslot" class="row">
            <div class="col-md-4 mT20 text-left">{{today}}</div>
            <ul class="list-group col-md-8">
              <div ng-if="timeArray == '0'">
              <li class="list-group-item">No slots available.</li>
              </div>
              <div ng-if="timeArray != '0'" ng-repeat="data in timeArray">
              <li class="list-group-item"><a ng-click="bookSlot(data.timeSlot,data.doctorId,today)">{{data.timeShow}}</a></li>
              </div>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="clr"> </div>
  </div>
</div>
<div class="classClicked"></div>
<!--Footer-->
<div ng-include="'layout/footer.view.html'"></div>
<link href="css/responsive-calendar.css" rel="stylesheet" />
<script src="js/responsive-calendar.js"></script>
<script type="text/javascript">


    //I added this script to get me current date
    var d = new Date();
    var curr_date = d.getDate();
    var curr_month = d.getMonth() + 1; //Months are zero based
    var curr_year = d.getFullYear();
    var today = curr_year + "-" + curr_month + "-" + curr_date;
    $(document).ready(function () {
        $(".clicked").click(function($event){
			var scope = angular.element(document.getElementsByClassName("classClicked")).scope();
			scope.$apply(function() {
				scope.classClicked($event);
			});
        });
        $(".modal-overlay").remove();
      
        $(".date_selct").click(function () {
        });
        var date=new Date();
        var day1=formatDate(date);
        today=formatDate(date);
        date.setDate(date.getDate() + 1);
        day2=formatDate(date);
        date.setDate(date.getDate() + 1);
        day3=formatDate(date);
        date.setDate(date.getDate() + 1);
        day4=formatDate(date);
        date.setDate(date.getDate() + 1);
        day5=formatDate(date);
        date.setDate(date.getDate() + 1);
        day6=formatDate(date);
        date.setDate(date.getDate() + 1);
        day7=formatDate(date);
        var eventdates= '"' + day1 + '"' +':{ "number": "times", "url": "" },' + '"' + day2 + '"' + ': { "number": "times", "url": "" },'+ '"' + day3 + '"' +': { "number": "times", "url": "" },'+ '"' + day4 + '"' + ': { "number": "times", "url": "" },'+ '"' + day5 + '"' + ': { "number": "times", "url": "" },'+ '"' + day6 + '"' + ': { "number": "times", "url": "" },'+ '"' + day7 + '"' +': { "number": "times", "url": "" }';
        myevents = '{'+eventdates+'}';
        //console.log(eventList);
        //var test='day1: { "number": "times", "url": "" },day2: { "number": "times", "url": "" },day3: { "number": "times", "url": "" },day4: { "number": "times", "url": "" },day5: { "number": "times", "url": "" },day6: { "number": "times", "url": "" },"2016-03-13": { "number": "times", "url": "" }';
        $(".responsive-calendar").responsiveCalendar({
            time: today,
            events: JSON.parse(myevents),
            onActiveDayClick: function (events) {
            var month=$(this).attr("data-month");
            if (month.length==1) {
                month="0"+month;
            }
            var date_day=$(this).attr("data-day");
            if (date_day.length==1) {
                date_day="0"+date_day;
            }
                var dateselect = $(this).attr("data-year") + "-" + month + "-" + date_day;
                var followUp = 0;
                var doctorType = $("#doctorType").val();
                var bookDocId=$("#bookDocId").val();
                url=freeTimeslot;
                data = {"specialist":doctorType,"date":dateselect,"requestFrom":"1","token":"38gsbTk9zG2UbW9Zh5saDkehhZaqfN9n","instant":"0","doctorId":bookDocId}
                $.ajax(
						 {
						     type: 'post',
						     url: url,
						     dataType: 'json',
                             data: JSON.stringify(data),
						     success: function (data) {
                                var returndata = ''
                                if (data.status==1) {
                                  if (data.data.length > 0) {
                                    var returndata = data.data;
                                  }
                                }
                                 html = '<div class="col-md-4 mT20 text-left">'+dateFormat(data.date)+'</div>';
                                 html = html+' <ul class="list-group col-md-8">';
                                 if (returndata!='') {
                                    for (i = 0; i < returndata.length; i++) {
                                      time = tConvert(returndata[i].timeSlot);
                                      html = html+" <li class='list-group-item MainWrap' style='cursor:pointer;'><a onclick='appointmentSlot(\""+returndata[i].timeSlot+"\",\""+returndata[i].doctorId+"\",\""+data.date+"\")'> "+time+"</a></li>";
                                    }
                                 }else{
                                    html = html+' <li class="list-group-item">No Slots available</li>';
                                 }
                                 html = html+'  </ul>';
                                 $("#selected_free_timeslot").html(html);       
						     }
						 });
                // end ajax  				
            }
        });
    });
    function appointmentSlot(data1, data2, data3) {
        var scope = angular.element(document.getElementsByClassName("MainWrap")).scope();
        scope.$apply(function () {
            scope.bookSlot(data1, data2, data3);
        });
    }
</script>

